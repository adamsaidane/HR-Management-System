@model HRMS.ViewModels.PositionDetailsViewModel
@{
    ViewData["Title"] = $"Poste - {Model.Position.Title}";
}

<div class="page-header d-flex justify-content-between align-items-center mb-4">
    <div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-1">
                <li class="breadcrumb-item"><a asp-action="Index">Départements</a></li>
                <li class="breadcrumb-item"><a asp-action="Details" asp-route-id="@Model.Department.DepartmentId">@Model.Department.Name</a></li>
                <li class="breadcrumb-item active">@Model.Position.Title</li>
            </ol>
        </nav>
        <h1><i class="fas fa-briefcase me-2"></i>@Model.Position.Title</h1>
        <span class="badge bg-info fs-6">@Model.Department.Name</span>
    </div>
    <div>
        @if (User.IsInRole("AdminRH"))
        {
            <a asp-action="EditPosition" asp-route-id="@Model.Position.PositionId" class="btn btn-warning">
                <i class="fas fa-edit me-1"></i>Modifier
            </a>
        }
    </div>
</div>

<!-- Statistiques du poste -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="stat-card">
            <i class="fas fa-users icon text-primary"></i>
            <h6>Employés</h6>
            <h3 class="text-primary">@Model.TotalEmployees</h3>
            <small class="text-muted">Occupant ce poste</small>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card">
            <i class="fas fa-money-bill-wave icon text-success"></i>
            <h6>Salaire de Base</h6>
            <h3 class="text-success">@Model.Position.BaseSalary.ToString("N0") DT</h3>
            <small class="text-muted">Rémunération de base</small>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card">
            <i class="fas fa-calculator icon text-warning"></i>
            <h6>Masse Salariale</h6>
            <h3 class="text-warning">@Model.TotalSalaryMass.ToString("N0") DT</h3>
            <small class="text-muted">Total pour ce poste</small>
        </div>
    </div>
</div>

<!-- Informations du poste -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-white">
        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Informations du Poste</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-8">
                <p><strong>Description:</strong></p>
                <p class="text-muted">@(Model.Position.Description ?? "Aucune description disponible")</p>
            </div>
            <div class="col-md-4">
                <p><strong>Département:</strong></p>
                <p>
                    <a asp-action="Details" asp-route-id="@Model.Department.DepartmentId" class="text-decoration-none">
                        <i class="fas fa-building me-1"></i>@Model.Department.Name
                    </a>
                </p>
                <p><strong>Date de création:</strong></p>
                <p class="text-muted">@Model.Position.CreatedDate.ToString("dd/MM/yyyy")</p>
            </div>
        </div>
    </div>
</div>

<!-- Liste des employés -->
<div class="card shadow-sm">
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
            <i class="fas fa-users me-2"></i>Employés occupant ce poste
            <span class="badge bg-primary ms-2">@Model.TotalEmployees</span>
        </h5>
    </div>
    <div class="card-body p-0">
        @if (Model.Employees.Any())
        {
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 5%;">#</th>
                            <th style="width: 12%;">Matricule</th>
                            <th style="width: 25%;">Nom Complet</th>
                            <th style="width: 20%;">Email</th>
                            <th style="width: 13%;">Téléphone</th>
                            <th style="width: 12%;">Ancienneté</th>
                            <th style="width: 13%;" class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            int rowNumber = 1;
                        }
                        @foreach (var employee in Model.Employees)
                        {
                            var anciennete = (DateTime.Now - employee.HireDate).Days / 365;
                            <tr>
                                <td class="text-muted align-middle">@rowNumber</td>
                                <td class="align-middle">
                                    <span class="badge bg-secondary">@employee.Matricule</span>
                                </td>
                                <td class="align-middle">
                                    <div class="d-flex align-items-center">
                                        @if (!string.IsNullOrEmpty(employee.PhotoPath))
                                        {
                                            <img src="@employee.PhotoPath" alt="Photo" 
                                                 class="rounded-circle me-2" 
                                                 style="width:35px;height:35px;object-fit:cover;" />
                                        }
                                        else
                                        {
                                            <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center text-white me-2" 
                                                 style="width:35px;height:35px;">
                                                <i class="fas fa-user"></i>
                                            </div>
                                        }
                                        <strong>@employee.FullName</strong>
                                    </div>
                                </td>
                                <td class="align-middle"><small>@employee.Email</small></td>
                                <td class="align-middle"><small>@employee.Phone</small></td>
                                <td class="align-middle">
                                    <span class="badge bg-info">@anciennete an(s)</span>
                                    <br /><small class="text-muted">depuis @employee.HireDate.ToString("dd/MM/yyyy")</small>
                                </td>
                                <td class="text-center align-middle">
                                    <div class="btn-group btn-group-sm">
                                        <a asp-controller="Employees" asp-action="Details" 
                                           asp-route-id="@employee.EmployeeId"
                                           class="btn btn-primary" title="Voir profil">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a asp-controller="Salaries" asp-action="EmployeeSalary" 
                                           asp-route-employeeId="@employee.EmployeeId"
                                           class="btn btn-success" title="Voir salaire">
                                            <i class="fas fa-money-bill-wave"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            rowNumber++;
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="p-5 text-center text-muted">
                <i class="fas fa-user-slash fa-4x mb-3"></i>
                <h5>Aucun employé</h5>
                <p class="mb-0">Aucun employé actif n'occupe actuellement ce poste.</p>
            </div>
        }
    </div>
</div>

<style>
    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    table tbody tr {
        animation: fadeInUp 0.3s ease-out;
    }

    table tbody tr:nth-child(even) {
        background-color: #f8f9fa;
    }

    table tbody tr:hover {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
</style>
