@model HRMS.ViewModels.EmployeeDetailsViewModel
@{
    ViewData["Title"] = "Détails Employé - " + Model.Employee.FullName;
}

<div class="page-header d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-user me-2"></i>@Model.Employee.FullName</h1>
    <div>
        <a asp-action="Edit" asp-route-id="@Model.Employee.EmployeeId" class="btn btn-warning">
            <i class="fas fa-edit me-2"></i>Modifier
        </a>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Retour
        </a>
    </div>
</div>

<div class="row">
    <!-- Colonne Gauche: Profil -->
    <div class="col-lg-4 mb-4">
        <div class="card shadow-sm text-center">
            <div class="card-body">
                @if (!string.IsNullOrEmpty(Model.Employee.PhotoPath))
                {
                    <img src="@Model.Employee.PhotoPath" alt="Photo" class="img-thumbnail rounded-circle mb-3" 
                         style="width:200px;height:200px;object-fit:cover;" />
                }
                else
                {
                    <div class="bg-secondary rounded-circle d-inline-flex align-items-center justify-content-center text-white mb-3" 
                         style="width:200px;height:200px;">
                        <i class="fas fa-user fa-4x"></i>
                    </div>
                }
                <h3 class="mb-1">@Model.Employee.FullName</h3>
                <p class="text-muted mb-2">@Model.Employee.Position.Title</p>
                <span class="badge bg-@(Model.Employee.Status == HRMS.Enums.EmployeeStatus.Actif ? "success" : "danger") fs-6">
                    @Model.Employee.Status
                </span>
            </div>
        </div>

        <div class="card shadow-sm mt-3">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-id-card me-2"></i>Informations</h5>
            </div>
            <div class="list-group list-group-flush">
                <div class="list-group-item">
                    <small class="text-muted d-block">Matricule</small>
                    <strong>@Model.Employee.Matricule</strong>
                </div>
                <div class="list-group-item">
                    <small class="text-muted d-block">Genre</small>
                    <strong>@Model.Employee.Gender</strong>
                </div>
                <div class="list-group-item">
                    <small class="text-muted d-block">Email</small>
                    <a href="mailto:@Model.Employee.Email">@Model.Employee.Email</a>
                </div>
                <div class="list-group-item">
                    <small class="text-muted d-block">Téléphone</small>
                    <strong>@Model.Employee.Phone</strong>
                </div>
                <div class="list-group-item">
                    <small class="text-muted d-block">Date de naissance</small>
                    <strong>@Model.Employee.DateOfBirth.ToString("dd/MM/yyyy") (@Model.Employee.Age ans)</strong>
                </div>
                <div class="list-group-item">
                    <small class="text-muted d-block">Adresse</small>
                    <strong>@Model.Employee.Address</strong>
                </div>
            </div>
        </div>
    </div>

    <!-- Colonne Droite: Détails -->
    <div class="col-lg-8">
        <!-- Informations Professionnelles -->
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-briefcase me-2"></i>Informations Professionnelles</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <small class="text-muted d-block">Département</small>
                        <strong>@Model.Employee.Department.Name</strong>
                    </div>
                    <div class="col-md-6 mb-3">
                        <small class="text-muted d-block">Poste</small>
                        <strong>@Model.Employee.Position.Title</strong>
                    </div>
                    <div class="col-md-6 mb-3">
                        <small class="text-muted d-block">Type de contrat</small>
                        <strong>@Model.Employee.ContractType</strong>
                    </div>
                    <div class="col-md-6 mb-3">
                        <small class="text-muted d-block">Date d'embauche</small>
                        <strong>@Model.Employee.HireDate.ToString("dd/MM/yyyy")</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rémunération -->
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-money-bill-wave me-2"></i>Rémunération</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-4">
                        <h6 class="text-muted">Salaire de Base</h6>
                        <h3 class="text-primary">@Model.CurrentSalary.ToString("N2") DT</h3>
                    </div>
                    <div class="col-4">
                        <h6 class="text-muted">Avantages</h6>
                        <h3 class="text-success">@Model.TotalBenefits.ToString("N2") DT</h3>
                    </div>
                    <div class="col-4">
                        <h6 class="text-muted">Salaire Brut</h6>
                        <h3 class="text-warning">@Model.GrossSalary.ToString("N2") DT</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Onglets -->
        <ul class="nav nav-tabs" id="employeeTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#salaryHistory">
                    <i class="fas fa-history me-1"></i>Salaire
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#bonuses">
                    <i class="fas fa-gift me-1"></i>Primes
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#equipment">
                    <i class="fas fa-laptop me-1"></i>Équipements
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#promotions">
                    <i class="fas fa-chart-line me-1"></i>Promotions
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#documents">
                    <i class="fas fa-file me-1"></i>Documents
                </button>
            </li>
        </ul>

        <div class="tab-content border border-top-0 p-3 bg-white" id="employeeTabsContent">
            <!-- Historique Salaire -->
            <div class="tab-pane fade show active" id="salaryHistory">
                @if (Model.SalaryHistory.Any())
                {
                    <table class="table table-sm">
                        <thead><tr><th>Date</th><th>Salaire</th><th>Justification</th></tr></thead>
                        <tbody>
                            @foreach (var salary in Model.SalaryHistory)
                            {
                                <tr>
                                    <td>@salary.EffectiveDate.ToString("dd/MM/yyyy")</td>
                                    <td><strong>@salary.BaseSalary.ToString("N2") DT</strong></td>
                                    <td>@salary.Justification</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">Aucun historique</p>
                }
            </div>

            <!-- Primes -->
            <div class="tab-pane fade" id="bonuses">
                @if (Model.Bonuses.Any())
                {
                    <table class="table table-sm">
                        <thead><tr><th>Date</th><th>Type</th><th>Montant</th><th>Description</th></tr></thead>
                        <tbody>
                            @foreach (var bonus in Model.Bonuses)
                            {
                                <tr>
                                    <td>@bonus.Date.ToString("dd/MM/yyyy")</td>
                                    <td>@bonus.BonusType</td>
                                    <td class="text-success"><strong>@bonus.Amount.ToString("N2") DT</strong></td>
                                    <td>@bonus.Description</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">Aucune prime</p>
                }
            </div>

            <!-- Équipements -->
            <div class="tab-pane fade" id="equipment">
                @if (Model.Equipments.Any())
                {
                    <table class="table table-sm">
                        <thead><tr><th>Équipement</th><th>Date</th><th>État</th><th>Statut</th></tr></thead>
                        <tbody>
                            @foreach (var eq in Model.Equipments)
                            {
                                <tr>
                                    <td>@eq.Equipment.EquipmentType - @eq.Equipment.Brand @eq.Equipment.Model</td>
                                    <td>@eq.AssignmentDate.ToString("dd/MM/yyyy")</td>
                                    <td>@eq.Condition</td>
                                    <td>
                                        @if (eq.ReturnDate.HasValue)
                                        {
                                            <span class="badge bg-secondary">Restitué</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success">En cours</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">Aucun équipement</p>
                }
            </div>

            <!-- Promotions -->
            <div class="tab-pane fade" id="promotions">
                @if (Model.Promotions.Any())
                {
                    <table class="table table-sm">
                        <thead><tr><th>Date</th><th>Ancien</th><th>Nouveau</th><th>Augmentation</th></tr></thead>
                        <tbody>
                            @foreach (var promo in Model.Promotions)
                            {
                                <tr>
                                    <td>@promo.PromotionDate.ToString("dd/MM/yyyy")</td>
                                    <td>@promo.OldPosition.Title</td>
                                    <td><strong>@promo.NewPosition.Title</strong></td>
                                    <td class="text-success">+@((promo.NewSalary - promo.OldSalary).ToString("N2")) DT</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">Aucune promotion</p>
                }
            </div>

            <!-- Documents -->
            <div class="tab-pane fade" id="documents">
                @if (Model.Documents.Any())
                {
                    <table class="table table-sm">
                        <thead><tr><th>Type</th><th>Fichier</th><th>Date</th><th>Action</th></tr></thead>
                        <tbody>
                            @foreach (var doc in Model.Documents)
                            {
                                <tr>
                                    <td>@doc.DocumentType</td>
                                    <td>@doc.FileName</td>
                                    <td>@doc.UploadDate.ToString("dd/MM/yyyy")</td>
                                    <td><a href="@doc.FilePath" class="btn btn-sm btn-primary" target="_blank">
                                        <i class="fas fa-download"></i>
                                    </a></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                <hr/>
                <h6>Ajouter un document</h6>
                <form method="post" asp-action="UploadDocument" asp-controller="Employees" enctype="multipart/form-data">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="employeeId" value="@Model.Employee.EmployeeId" />
                    <div class="row g-2">
                        <div class="col-md-4">
                            <select name="documentType" class="form-select form-select-sm" required>
                                <option value="">Type</option>
                                <option value="CV">CV</option>
                                <option value="Contrat">Contrat</option>
                                <option value="Diplôme">Diplôme</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <input type="file" name="file" class="form-control form-control-sm" required />
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-sm btn-primary w-100">
                                <i class="fas fa-upload"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>